#!/usr/bin/env bash

reset() {
	pushd .. >/dev/null 2>&1
	repo sync -q -l --force-sync "$1"
	popd >/dev/null 2>&1
}

apply() {
	git -C "../$1"		am "$PWD/$1/$2"
}

pushd `dirname "$0"` >/dev/null 2>&1

reset	"frameworks/base"
reset	"system/core"
reset	"build/make"
reset	"bionic"
reset	"device/motorola/sanders"

apply	"frameworks/base"	"0001-Scroll-modified-velocitytracker.patch"
apply	"frameworks/base"	"0002-Frequently-used-OpenGL-ES-methods-whitelisted-for-fa.patch"
apply	"frameworks/base"	"0003-aapt-Default-to-0-compression-ratio.patch"
apply	"frameworks/base"	"0004-aapt-allow-opting-out-of-uncompressed-aapt.patch"
apply	"frameworks/base"	"0005-aapt-enforce-0-compression.patch"
apply	"frameworks/base"	"0006-frameworks-base-Fix-ContentService-JNI-leaks.patch"
apply	"frameworks/base"	"0007-core-jni-use-O3.patch"
apply	"frameworks/base"	"0008-DeadZone-add-missing-call-to-TypedArray.recycle.patch"
apply	"frameworks/base"	"0009-Optimize-AbsListView-to-reduce-click-operation-laten.patch"

apply 	"system/core"		"0001-use-std-hash-instead-of-hashing-byte-by-byte.patch"
apply 	"system/core"		"0002-Enable-HAS_VFP_D32-for-32-bit-armv8-crasher.patch"
apply 	"system/core"		"0003-Silence-spammy-logs-from-camera-blobs-AEC_PORT-and-m.patch"
apply 	"system/core"		"0004-fix-null-pointer-and-memory-leak-issue.patch"
apply 	"system/core"		"0005-System-Server-Force-Close.patch"
apply	"system/core"		"0006-init-optimize-shutdown-time.patch"

apply	"build/make"		"0001-core-use-0-compression-when-creating-the-target_file.patch"
apply	"build/make"		"0002-Create-0-compression-ratio-jar-files.patch"
apply	"build/make"		"0003-Enable-GSS-garbage-collection.patch"
apply	"build/make"		"0004-zipalign-use-Zopfli-recompress-option.patch"

apply	"bionic"		"0001-Enable-32-bit-armv8-NEON-for-libm.patch"
apply   "bionic"                "0002-AArch64-Optimized-memcmp.patch"
apply   "bionic"                "0003-Optimize-the-clone-system-call-on-ARM-64.patch"
apply   "bionic"                "0004-Remove-an-obsolete-aarch64-hack.patch"
apply   "bionic"                "0005-libc-Optimize-ARM-memcmp-by-using-NEON.patch"
apply   "bionic"                "0006-libc-add-optimized-ARM64-strrchr-from-newlib.patch"
apply   "bionic"                "0007-libc-import-ARM-strcmp-from-newlib.patch"
apply   "bionic"                "0008-Find-clang-correctly.patch"
apply   "bionic"                "0009-bionic-strip-libc-and-linker.patch"
apply   "bionic"                "0010-AArch64-memcmp.S-optimize-for-medium-to-large-sizes.patch"
apply   "bionic"                "0011-AArch64-strcmp.S-Improve-performance-for-misaligned-.patch"
apply   "bionic"                "0012-aarch64-Improve-strncmp-for-mutually-misaligned-inpu.patch"
apply   "bionic"                "0013-aarch64-strncmp-Use-lsr-instead-of-mov-lsr.patch"
apply   "bionic"                "0014-libc-kryo-import-ARM-strlen-from-Apple-C-library.patch"
apply   "bionic"                "0015-libc-arm-Optimise-memchr-for-NEON-enabled-processors.patch"
apply   "bionic"                "0016-Use-builtins-for-fma-fmax-fmin-round-on-arm64.patch"
apply   "bionic"                "0017-Add-remaining-AArch32-and-ARM64-builtin-math-routine.patch"

apply	"device/motorola/sanders"	"0001-sanders-overlay-Enable-turbo-power-charger-support.patch"
apply	"device/motorola/sanders"	"0002-Set-up-EAS-on-device-boot.patch"
apply	"device/motorola/sanders"	"0003-sanders-Include-ARCore.patch"

popd >/dev/null 2>&1
